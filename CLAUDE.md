# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Что это

Плагин для Claude Code, реализующий 7-фазный воркфлоу разработки доработок в существующих конфигурациях 1С:Предприятие. Адаптация [feature-dev](https://github.com/anthropics/claude-plugins-official/tree/main/plugins/feature-dev) от Anthropic для платформы 1С.

## Архитектура

Плагин состоит из трёх слоёв:

1. **Скиллы** (`skills/*/SKILL.md`) — команды, доступные пользователю:
   - `1c-feature-dev` — основной воркфлоу из 7 фаз (Discovery -> Исследование -> Уточняющие вопросы -> Архитектура -> Реализация -> Проверка качества -> Итоги). Оркестрирует агентов и управляет переходами между фазами.
   - `1c-ssl` — справка по подсистемам БСП/SSL. Напоминает проверять наличие готового решения в БСП через MCP-инструмент `ssl_search` перед написанием кастомного кода. Содержит перечень ключевых модулей БСП.
   - `1c-query-optimization` — продвинутые паттерны оптимизации запросов 1С: временные таблицы, соединения vs подзапросы, параметры виртуальных таблиц, `ВЫРАЗИТЬ` для составных типов, `ПРЕДСТАВЛЕНИЕ`, `ОБЪЕДИНИТЬ ВСЕ`, выравнивание по индексам. Основан на стандартах ИТС.

2. **Агенты** (`agents/*.md`) — специализированные субагенты, запускаемые параллельно (обычно по 3) на ключевых фазах:
   - `1c-code-explorer` (Phase 2) — трассировка существующего кода, анализ паттернов
   - `1c-code-architect` (Phase 4) — проектирование архитектуры с разными компромиссами
   - `1c-code-writer` (Phase 5, 6) — написание и исправление кода по плану
   - `1c-code-reviewer` (Phase 6) — ревью с confidence-based filtering (порог >= 75)

3. **Правила** (`rules/1c-rules.md`) — стандарты кодирования 1С, читаемые агентами `1c-code-writer` и `1c-code-reviewer` перед работой.

## Ключевые потоки данных

- Агенты возвращают списки ключевых файлов — основной агент обязан их прочитать для построения контекста
- Phase 4 создаёт файл плана `.tasks/task-[name]/plan.md` — Phase 5 и 6 работают по этому плану
- Phase 6 итеративна: ревью -> исправление -> повторное ревью, пока нет критических проблем
- Каждая фаза требует явного одобрения пользователя перед переходом к следующей

## Правила кодирования 1С (из rules/1c-rules.md)

- Области модулей: `ПрограммныйИнтерфейс` (public), `СлужебныйПрограммныйИнтерфейс` (private), `СлужебныеПроцедурыИФункции` (protected)
- Запросы: формат `Запрос = Новый Запрос;` с текстом на новой строке; всегда псевдонимы через `КАК`; промежуточная переменная `РезультатЗапроса`; не использовать запросы в цикле
- Не использовать `Сообщить()` — вместо него `ОбщегоНазначения.СообщитьПользователю` (сервер) / `ОбщегоНазначенияКлиент.СообщитьПользователю` (клиент)
- Не получать реквизиты через точку от ссылки — использовать `ОбщегоНазначения.ЗначениеРеквизитаОбъекта` / `ЗначениеРеквизитовОбъекта` / `ЗначениеРеквизитаОбъектов`
- Проверять экспортные методы в общих модулях и модулях менеджеров для переиспользования
- Ограничение строки 120 символов; без тернарных операторов; без венгерской нотации
- Не использовать имена из глобального контекста 1С для переменных (Документы, Справочники, Регистры, Метаданные, Константы и др.)
- В формах: минимизировать переходы клиент-сервер; предпочитать `&НаСервереБезКонтекста`; предпочитать `Асинх` вместо `ОписаниеОповещения`
- Кешировать повторяющиеся вычисления в цикле через Соответствие
- Проверять конкурентность и корректность блокировок/транзакций

## Установка

Через маркетплейс (рекомендуется):
```bash
/plugin marketplace add owner/1c-feature-dev
/plugin install 1c-feature-dev
```

Вручную:
```bash
cp agents/*.md ~/.claude/agents/
cp -r skills/* ~/.claude/skills/
cp rules/1c-rules.md ~/.claude/rules/
```

## Требования

- Конфигурация 1С, выгруженная в файлы
- MCP-сервер справки 1С (опционально, для проверки синтаксиса агентами)
